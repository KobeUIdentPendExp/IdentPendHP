<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ロボット制御実験 環境構築ガイド (Windows 版)</title>
    <style>
        /* Reusing styles */
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; line-height: 1.7; padding: 20px; background-color: #f9f9f9; }
        .guide-container { max-width: 900px; margin: auto; background-color: #fff; padding: 30px 40px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .section { border: 1px solid #e0e0e0; background-color: #ffffff; padding: 20px; margin-bottom: 25px; border-radius: 5px; }
        .section h3 { margin-top: 0; border-bottom: 2px solid #007bff; padding-bottom: 8px; color: #0056b3; }
        .step { background-color: #f8f9fa; border: 1px solid #ced4da; padding: 10px 15px; margin: 10px 0; border-radius: 4px; }
        .confirmation { background-color: #e6fff2; border: 1px solid #b3ffcc; color: #00642e; padding: 10px 15px; margin: 10px 0; border-radius: 4px; } /* Verification green */
        .warning { background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 10px 15px; margin: 10px 0; border-radius: 4px; } /* Warning yellow */
        .troubleshooting { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 10px 15px; margin: 15px 0; border-radius: 4px; } /* Troubleshooting red-ish */
        .step ul, .step ol, .troubleshooting ul { margin-top: 5px; margin-bottom: 5px; padding-left: 25px; }
        .step li, .troubleshooting li { margin-bottom: 5px; }
        .note { font-size: 0.9em; color: #555; margin-top: 10px; }
        .code { font-family: 'Courier New', Courier, monospace; background-color: #e9ecef; padding: 2px 5px; border-radius: 3px; color: #c7254e; font-size: 0.95em; }
        .command { font-family: 'Courier New', Courier, monospace; background-color: #212529; color: #f8f9fa; padding: 10px 15px; margin: 10px 0; border-radius: 4px; display: block; white-space: pre; } /* Command style */
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
    <script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } }; </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>

<div class="guide-container">
    <h2>ロボット制御実験 環境構築ガイド (Windows 版)</h2>
    <p class="note">このガイドは、システム同定から強化学習までの全実験に必要なソフトウェア環境を、Windows PC に構築するための手順を説明する。主な構成要素は Webots シミュレータと Anaconda (Python) である。</p>

    <div class="section" id="webots-install">
        <h3>1. Webots シミュレータのインストール</h3>
        <p>強化学習の実験 (第6回) で使用するロボットシミュレータ Webots をインストールする。</p>
        <div class="step">
            <strong>ダウンロード:</strong>
            <ul>
                <li><a href="https://cyberbotics.com/" target="_blank" rel="noopener noreferrer">Webots 公式サイト</a>にアクセスし、「Download」セクションへ進む。</li>
                <li>お使いの OS (Windows) に対応した最新の安定版 (Stable Release) をダウンロードする。</li>
            </ul>
        </div>
        <div class="step">
            <strong>インストール:</strong>
            <ul>
                <li>ダウンロードしたインストーラーを実行し、画面の指示に従ってインストールを進める。（通常はデフォルト設定のままで問題ない）</li>
            </ul>
        </div>
        <div class="confirmation">
            <strong>確認:</strong> インストール後、Webots アプリケーションを起動し、サンプルワールドなどが開けることを確認する。
        </div>
    </div>

    <div class="section" id="anaconda-install">
        <h3>2. Anaconda (Python 環境) のインストール</h3>
        <p>全ての実験で使用する Python スクリプトを実行するために、Anaconda または Miniconda を使用して Python 環境を管理する。（すでにインストール済みの場合はこのセクションをスキップし、セクション3に進むこと）</p>
        <div class="step">
            <strong>ダウンロード (未インストールの場合):</strong>
            <ul>
                <li><strong>Anaconda (推奨):</strong> データサイエンス関連のライブラリが多く含まれる。<a href="https://www.anaconda.com/download" target="_blank" rel="noopener noreferrer">Anaconda Distribution</a> からダウンロード。</li>
                <li><strong>Miniconda:</strong> より軽量なインストーラー。必要なライブラリは後で追加する。<a href="https://docs.conda.io/projects/miniconda/en/latest/" target="_blank" rel="noopener noreferrer">Miniconda Documentation</a> からダウンロード。</li>
            </ul>
        </div>
        <div class="step">
            <strong>インストール (未インストールの場合):</strong>
            <ul>
                <li>ダウンロードしたインストーラーを実行し、指示に従う。</li>
                <li>インストール中、「Advanced Options」画面で<strong style="color: #c7254e;">「Add Anaconda3 to my PATH environment variable」にチェックを入れる</strong>と、通常のコマンドプロンプトや PowerShell から直接 <code class="code">conda</code> コマンドが使えるようになるため便利である。<br>
                    <span class="note warning">(注意: Anaconda は他の Python 環境との競合を避けるため、このオプションのチェックを非推奨としている。もし他の Python を多用する場合は競合のリスクを理解した上でチェックするか、チェックせずに Anaconda Prompt を使用すること。)</span></li>
                <li>チェックしない場合は、Windows スタートメニューから「Anaconda Prompt」を起動して <code class="code">conda</code> コマンドを使用するのが基本となる。</li>
            </ul>
        </div>
        <div class="troubleshooting">
             <strong>【補足】インストール後に <code class="code">conda</code> コマンドが見つからない場合</strong>
             <ul>
                <li>インストール時に「Add Anaconda3 to my PATH...」に<strong>チェックを入れなかった</strong>場合：<br>これは想定通りの動作である。Windows のスタートメニューから <strong>「Anaconda Prompt」</strong> を検索して起動し、そのウィンドウ内で <code class="code">conda</code> コマンドを使用すること。</li>
                <li>インストール時に<strong>チェックを入れたはずなのに</strong> <code class="code">conda</code> が認識されない場合：
                    <ul>
                       <li>まず PC を再起動してみる。</li>
                       <li>それでも認識されない場合、環境変数 PATH が正しく設定されていない可能性がある。環境変数を手動で設定する方法もあるが、手順がやや複雑になる。不明な場合は、一度 Anaconda をアンインストールし、再度インストール（PATH オプションのチェックを確認して）を試すのが比較的確実である。</li>
                       <li><span class="note">(手動設定する場合の参考パス例: 通常は <code class="code">C:\Users\YourName\anaconda3\Scripts</code>, <code class="code">C:\Users\YourName\anaconda3\Library\bin</code>, <code class="code">C:\Users\YourName\anaconda3\condabin</code> などが必要になるが、具体的なパスはインストール場所やバージョンにより異なる。)</span></li>
                    </ul>
                </li>
             </ul>
        </div>
        <div class="step task">
            <strong>【推奨】専用 Conda 環境の作成:</strong>
            <p>実験に必要なライブラリを他の Python プロジェクトと分離し、バージョンの衝突を防ぐために、専用の環境を作成することを強く推奨する。</p>
            <ol>
                <li><strong>Anaconda Prompt</strong> (または PATH設定済みのコマンドプロンプト/PowerShell) を開く。</li>
                <li>以下のコマンドを実行して、<code class="code">control_lab</code> という名前で Python 3.9 (推奨例) の環境を作成する:
                    <code class="command">conda create --name control_lab python=3.9</code>
                    (作成を確認するプロンプトが出たら `y` を入力して Enter)
                </li>
                <li>作成した環境を有効化（アクティベート）する:
                    <code class="command">conda activate control_lab</code>
                    (プロンプトの先頭に <code class="code">(control_lab)</code> と表示されれば成功だ)
                </li>
            </ol>
             <p class="note">以降の Python パッケージのインストールは、必ずこの <code class="code">control_lab</code> 環境が**アクティブな状態**で行うこと。</p>
       </div>
    </div>

    <div class="section" id="pip-install">
        <h3>3. 必要な Python パッケージのインストール</h3>
        <p>実験で使用するライブラリをインストールする。</p>
        <div class="step task">
            <strong>【パッケージのインストール】</strong>
            <ol>
                <li><strong>Anaconda Prompt</strong> (または PATH設定済みのコマンドプロンプト/PowerShell) を開き、<strong>必ず <code class="code">control_lab</code> 環境を有効化すること</strong>:
                    <code class="command">conda activate control_lab</code>
                </li>
                <li>以下のコマンドを実行して、基本的な科学計算ライブラリをインストールする (Anaconda を使っていれば既に一部入っている可能性もある):
                    <code class="command">conda install numpy scipy matplotlib</code>
                    (インストールを確認されたら `y` を入力)
                </li>
                 <li>次に、強化学習とハードウェア通信に必要なライブラリを `pip` を使ってインストールする:
                     <code class="command">pip install gymnasium stable-baselines3 torch torchvision torchaudio</code>
                     <span class="note">(<code class="code">stable-baselines3</code> 本体と、PyTorch 等の関連ライブラリをインストールする。もし PyTorch のインストールで問題が出る場合は、<a href="https://pytorch.org/" target="_blank" rel="noopener noreferrer">PyTorch 公式サイト</a> の指示に従って別途インストールを試みること。)</span>
                 </li>
            </ol>
        </div>
    </div>

     <div class="section" id="verification">
         <h3>5. 環境構築の最終確認</h3>
         <div class="step">
               <ol>
                   <li><strong>Anaconda Prompt</strong> (または PATH設定済みのコマンドプロンプト/PowerShell) で、<code class="code">control_lab</code> 環境がアクティブなことを確認する (<code class="code">(control_lab)</code> が先頭に表示)。</li>
                   <li>Python のバージョンを確認する: <code class="command">python --version</code></li>
                   <li>インストールされた主要なパッケージを確認する:
                       <code class="command">conda list numpy matplotlib scipy gymnasium stable-baselines3 torch hidapi</code>
                       (リストに表示され、バージョン情報が出ていれば OK。hidapi は別セクションでインストールする場合あり)
                   </li>
                   <li>Python インタプリタを起動し (<code class="code">python</code> と入力)、ライブラリが import できるか試す:
                       <code class="command">import numpy as np
import matplotlib.pyplot as plt
import scipy
import gymnasium as gym
import stable_baselines3
import torch
exit()</code>
                       (エラーなくプロンプトに戻れば成功)
                   </li>
                    <li>Webots アプリケーションを起動できることを確認する。</li>
               </ol>
         </div>
          <div class="confirmation">
               <strong>【完了】</strong> 上記の確認が全て問題なければ、実験に必要な環境の準備は完了である！
          </div>
     </div>
     <div class="section" id="webots-python-config">
         <h3>6. Webots と Anaconda Python 環境の連携設定</h3>
         <p class="warning">【重要】この設定を行わないと、Webots は正しい Python 環境（<code class="code">control_lab</code>）を見つけられず、コントローラースクリプトがライブラリ不足でエラーになる。</p>

         <div class="step task">
             <strong>Step 1: <code class="code">control_lab</code> 環境の Python パスを確認する</strong>
             <ol>
                 <li><strong>Anaconda Prompt</strong> (または PATH設定済みのコマンドプロンプト/PowerShell) を開く。</li>
                 <li>まず、作成した Conda 環境を有効化する:
                     <code class="command">conda activate control_lab</code>
                     (プロンプト先頭に <code class="code">(control_lab)</code> が表示されることを確認)
                 </li>
                 <li>次に、現在アクティブな環境の Python 実行ファイルのフルパスを調べるコマンドを実行する:
                     <ul>
                          <li><strong>Windows の場合:</strong>
                              <code class="command">where python</code>
                              <p class="note">(もし複数のパスが表示されたら、通常は <code class="code">anaconda3\envs\control_lab</code> 内のパスが対象)</p>
                              <p>または、より確実に実行ファイルパスを得るには:</p>
                              <code class="command">python -c "import sys; print(sys.executable)"</code>
                          </li>
                     </ul>
                 </li>
                 <li class="confirmation">コマンドは、以下のようなパスを出力する（表示はあなたの環境によって異なる）:
                     <br><code class="code">C:\Users\YourName\anaconda3\envs\control_lab\python.exe</code> (Windows 例)
                     <br>この**フルパス**（ファイルの場所全体）を**コピー**しておく。
                 </li>
             </ol>
         </div>

         <div class="step task">
             <strong>Step 2: Webots の設定を変更する</strong>
             <ol>
                 <li>Webots アプリケーションを起動する。</li>
                 <li>メニューバーから <code class="code">Tools</code> (ツール) -> <code class="code">Preferences...</code> (設定...) を選択する。</li>
                 <li>表示された Preferences ウィンドウで、<code class="code">General</code> (一般) タブを選択する。</li>
                 <li><code class="code">Python command</code> (Python コマンド) という名前の入力フィールドを探す。</li>
                 <li class="confirmation">【設定】このフィールドに、<strong>Step 1 でコピーした Python 実行ファイルのフルパスを貼り付ける</strong>。パスが正しく、ファイル名 (<code class="code">python.exe</code>) まで含まれていることを確認する。</li>
                 <li><code class="code">OK</code> または <code class="code">Apply</code> ボタンをクリックして設定を保存し、Preferences ウィンドウを閉じる。</li>
             </ol>
              <div style="text-align: center; margin-top: 15px; margin-bottom: 10px;">
                  <img src="WebotsPythonPathSetting.gif"
                        alt="Webots PreferencesでPythonコマンドのパスを設定する手順のGIFアニメーション"
                        style="max-width: 80%; height: auto; border: 1px solid #ccc; display: block; margin-left: auto; margin-right: auto;">
                  <p class="note" style="margin-top: 5px;">(図：Webots 設定画面での Python パス設定手順)</p>
              </div>
         </div>
         <div class="confirmation">
              <strong>【設定完了】</strong> これで、Webots はロボットのコントローラとして Python スクリプトが指定された際に、<code class="code">control_lab</code> 環境の Python を使用して実行するようになる。
         </div>
          <p class="note">もし設定後も Python ライブラリが見つからないエラーが出る場合は、パスが正しいか、Conda 環境が壊れていないかなどを再確認すること。</p>
     </div>
     </div> </body>
</html>
